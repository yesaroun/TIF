# 2.2.8.1 json-file 로그 사용하기

도커는 컨테이너 표준 출력(`StdOut`)과 에러(`StdErr`) 로그를 별도의 메타데이터 파일로 저장하며 이를 확인하는 명령어 제공

다음처럼 mysql 컨테이너 백그라운드 모드로 생성후 docker logs 명령어 사용해서 컨테이너의 표준 출력 확인

```bash
docker run -d --name mysql \
-e MYSQL_ROOT_PASSWORD=1234 \
mysql:5.7
```

```bash
docker logs mysql
```

다음처럼 `--tail` 옵션 사용해 출력 줄의 수 설정 가능

```bash
docker logs --tail 2 mysql
```

`--since`  옵션에 유닉스 시간을 입력해 특정 시간 이후의 로그 확인 가능

```bash
docker logs --since 1474765979
```

`-t` 옵션: 타임스탬프 표시
`-f` 옵션: 로그를 스트림(**마치 흐르는 물(스트림)처럼 로그가 계속해서 표시되는 형태로 계속 로그 확인 가능**)으로 확인 → 특히 개발할때 유용

```bash
docker logs -f -t mysql
```

docker logs 명령어는 run 명령어에서 -i -t 옵션을 설정해 docker attach 명령어를 사용할 수 있는 컨테이너에도 사용할 수 있으며, 컨테이너 내부에서 bash 셸 등을 입출력한 내용을 확인할 수 있다.

- -i -t 옵션
    - **-i (interactive)**: 표준 입력(STDIN)을 활성화하여 컨테이너와 상호작용할 수 있게 합니다.
    - **-t (tty)**: 가상 터미널(pseudo-TTY)을 할당하여 터미널 환경을 제공합니다.

```bash
docker run -i -t --name longest ubuntu:24.04       
>>>                       
root@f0ce45819810:/# echo test!
test!

docker logs longest
root@f0ce45819810:/# echo test!
test!
```

기본적으로 컨테이너 로그는 JSON 형태로 도커 내부에 저장된다. 이파일은 다음 경로에 컨테이너의 ID로 시작하는 파일명으로 저장

```bash
cat /var/lib/docker/container/${CONTAINER_ID}/${CONTAINER_ID}-json.log
```

그러나 컨테이너 내부 출력이 너무 많은 상태로 방치하면 해당 파일 크기가 너무 커질 수 있음
그래서 `--log-opt` 옵션으로 컨테이너 json 로그 파일의 최대 크기를 지정할 수 있다.
`max-size` : 로그 파일의 최대 크기
`max-file` : 로그 파일의 개수

```bash
docker run -it \
--log-opt max-size=10k --log-opt max-file=3 \
--name log-test ubuntu:24.04
```

어떠한 설정도 하지 않았다면 도커는 위와 같이 컨테이너 로그를 JSON 파일로 저장하지만 그 밖에도 각종 로깅 드라이버를 사용하게 설정해 컨테이너 로그를 수집할 수 있습니다.

# 2.2.8.2 syslog 로그

syslog: 유닉스 계열 운영체제에서 로그를 수집하는 오래된 표준 중 하나
대부분의 유닉스 계열 운영체제에서는 syslog를 사용하는 인터페이스가 동일하기 때문에 체계적으로 로그를 수집하고 분석할 수 있다는 장점

# 2.2.8.3 fluentd 로깅

fluentd: 각종 로그를 수집하고 저장하는 오픈소스, 데이터 포맷으로 JSON사용하기에 쉽게 사용 가능, 수집되는 데이터를 AWS S3, HDFS(Haddop Distributed File System), MongoDB 등 다양한 저장소에 저장할 수 있다.

# 2.2.8.4 아마존 클라우드워치 로그

AWS에서는 로그 및 이벤트 등을 수집하고 저장해 시각적으로 보여주는 클라우드워치(CloudWatch)를 제공
도커를 AWS EC2에서 사용하고 있다면 다른 도구 설치 필요 없이 컨테이너에서 드라이버 옵션을 설정하는 것만으로 클라우드워치 로깅 드라이버를 사용할 수 있다.

다음 단계를 따른다.

- 클라우드워치에 해당하는 IAM 권한 생성
- 로그 그룹 생성
- 로그 그룹에 로그 스트림(LogStream) 생성
- 클라우드워치의 IAM 권한을 사용할 수 있는 EC2 인스턴스 생성과 로그 전송