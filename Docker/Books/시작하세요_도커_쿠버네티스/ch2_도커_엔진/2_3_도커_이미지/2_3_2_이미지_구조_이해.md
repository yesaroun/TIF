다음 명령어를 입력해 이미지의 더 자세한 정보를 확인해보자.

```bash
docker inspect ubuntu:24.04
docker inspect commit_test:first
docker inpsect commit_test:second
```

출력 결과 중에 주의 깊게 살펴볼 항목은 Layers 이다.

docker images에서 위 3개의 이미지 크기가 각각 78MB라고 출력돼도, 78MB 크기의 이미지가 3개 존재하는 것은 아니다. 이미지를 커밋할 때 컨테이너에서 변경된 사항만 새로운 레이어로 저장하고, 그 레이어를 포함해 새로운 이미지를 생성하기 때문에 전체 이미지의 실제 크기는 78MB + first 파일 크기 + second 파일 크기가 된다.

이러한 이미지의 레이어 구조는 `docker history` 명령으로 확인 가능

```bash
docker history commit_test:second
>>>
IMAGE          CREATED          CREATED BY    SIZE      COMMENT
c67691a17ae4   13 minutes ago   /bin/bash     111B      my second commit
fe710c3fb893   19 minutes ago   /bin/bash     77B       my first commit
a7ff8584a5ea   3 weeks ago      /bin/sh -c #(nop)  CMD ["/bin/bash"]             0B
```

`docker rmi` 명령어 : 이미지 삭제

```bash
docker rmi commit_test:first
>>>
Error response from daemon: conflict: unable to remove repository reference "commit_test:first" (must force) - container 66201e8b09b8 is using its referenced image fe710c3fb893
```

이렇게 에러가 발생하는 이유는 이미지를 사용 중인 컨테이너가 존재해서이다.
`docker rm -f [컨테이너 이름]` 처럼 -f 옵션을 추가해 강제로 삭제할 수도 있지만 이는 이미지 이름만 삭제하기 때문에 의미가 없다. 따라서 다음 명령어와 같이 컨테이너를 삭제한 뒤 이미지를 삭제하게 한다.

```bash
docker stop commit_test2 && docker rm commit_test2
docker rmi commit_test:first
>>>
Untagged: commit_test:first
```

commit_test:first 이미지를 삭제했다고 해서 실제로 해당 이미지의 레이어 파일이 삭제되지는 않는다. commit_test:first 이미지를 기반으로 하는 하위 이미지인 commit_test:second가 존재하기 때문.
→ 실제 이미지 파일을 삭제하지 않고 레이어에 부여된 이름만 삭제, rmi 명령어의 출력 결과인 Untagged: … 는 이미지에 부여된 이름만 삭제한다는 것을 뜻한다.

```bash
docker rmi commit_test:second
>>>
Untagged: commit_test:second
Deleted: sha256:c67691a17ae446449874dd7739f050
Deleted: sha256:e9e2ad9e98ae56b55bdc6475126963
Deleted: sha256:fe7dc446b82323057d6175a062909a
Deleted: sha256:185ce910dc416261216a8024309644
```

“Deleted:” 라는 출력 결과는 이미지 레이어가 실제로 삭제됐음을 뜻
commit_test:second 이미지를 사용하는 컨테이너가 없으니 바로 삭제 가능