검색 후 기법(6.4)

검색 결괄르 다시 정렬하는 두 가지 예를 소개한다.

# RAG-Fusion

각 쿼리의 검색 결과를 프롬프트에 넣을 때는 어떤 순서로 정렬할 필요가 있다.

여러 검색 결과의 순서를 융합해 정렬하는 알고리즘으로 RRF(Reciprocal Rank Fusion)가 있다. RRF에서는 각 검색 쿼리의 '1 / (순위 + k)'의 합곗값을 점수로 하여 점수의 크기로 검색 결과를 정렬한다. k는 RRF의 매개변수로, 60 등의 값을 사용한다.

LangChain으로 RAG-Fusion을 구현해보겠다. 먼저 RRF 처리를 함수로 구현한다.

```python
from langchain_core.documents import Document

def reciprocal_rank_fusion(
    retriever_outputs: list[list[Document]],
    k: int = 60,
) -> list[str]:
    # 각 문서의 콘텐츠(문자열)와 그 점수의 매핑을 저장하는 딕셔너리 준비
    content_score_mapping = {}
```
